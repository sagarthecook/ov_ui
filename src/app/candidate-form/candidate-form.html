<div class="candidate-form-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Candidate Election Form</mat-card-title>
    </mat-card-header>

     <mat-card-content>
      <!-- Success Message -->
      <div *ngIf="successMessage" class="success-message">
        <mat-icon>check_circle</mat-icon>
        <span>{{ successMessage }}</span>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage" class="error-message">
        <mat-icon>error</mat-icon>
        <span>{{ errorMessage }}</span>
      </div>
      
      <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()">
        <!-- Election and Party Dropdowns Row -->
        <div class="form-row">
          <!-- Election Dropdown Field -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Election</mat-label>
            <mat-select
              formControlName="election"
              (selectionChange)="onElectionChange($event.value)">
              <mat-option *ngFor="let e of electionList" [value]="e.id">
                {{ e.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="registrationForm.get('election')?.hasError('required')">
              Election is required
            </mat-error>
          </mat-form-field>

          <!-- Party Dropdown Field -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Party</mat-label>
            <mat-select
              formControlName="party"
              (selectionChange)="onPartyChange($event.value)"
            >
              <mat-option *ngFor="let p of partyList" [value]="p.id">
                {{ p.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="registrationForm.get('party')?.hasError('required')">
              Party is required
            </mat-error>
          </mat-form-field>
        </div>
         Party Logo
        <div class="form-row">
         
            <a *ngIf="logUrl" [href]="logUrl" target="_blank" 
           style="color: #2196F3; word-break: break-all; text-decoration: underline; font-size: 14px;">
          {{logUrl}}
        </a>
        </div>
        
             <!-- Address Details Section -->
        <div class="form-row">
          <div style="border: 2px solid #ddd; padding: 16px; border-radius: 4px; width: 100%;">
            <h3 style="margin-top: 0; margin-bottom: 16px; color: #333;">Ward / Locality Details</h3>
            <div formGroupName="address">
              <!-- Country, State, City Row -->
              <div class="form-row">
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Country</mat-label>
                  <mat-select []
                    formControlName="countryId"   
                    [disabled]="true"                   
                     (selectionChange)="onCountryChange($event.value)"
                  >
                    <mat-option *ngFor="let c of countries" [value]="c.id">
                      {{ c.name }}
                    </mat-option>
                  </mat-select>
                  <mat-icon matPrefix>public</mat-icon>
                  <mat-error *ngIf="address?.get('countryId')?.hasError('required')">
                    Country is required
                  </mat-error>
                </mat-form-field>
                
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>State</mat-label>
                  <mat-select
                    formControlName="stateId"
                    [disabled]="true"
                    (selectionChange)="onStateChange($event.value)"
                  >
                    <mat-option *ngFor="let s of states" [value]="s.id">
                      {{ s.name }}
                    </mat-option>
                  </mat-select>
                  <mat-icon matPrefix>location_on</mat-icon>
                  <mat-error *ngIf="address?.get('stateId')?.hasError('required')">
                    State is required
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>City</mat-label>
                  <mat-select formControlName="cityId" [disabled]="true">
                    <mat-option *ngFor="let ct of cities" [value]="ct.id">
                      {{ ct.name }}
                    </mat-option>
                  </mat-select>
                  <mat-icon matPrefix>location_city</mat-icon>
                  <mat-error *ngIf="address?.get('cityId')?.hasError('required')">
                    City is required
                  </mat-error>
                </mat-form-field>
              </div>

              <!-- Street and Zip Code Row -->
              <div class="form-row">
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Street Address</mat-label>
                  <input
                    matInput
                    formControlName="street"
                    placeholder="Enter street address / locality"
                  />
                  <mat-icon matPrefix>home</mat-icon>
                  <mat-error *ngIf="address?.get('street')?.hasError('required')">
                    Street address is required
                  </mat-error>
                  <mat-error *ngIf="address?.get('street')?.hasError('maxlength')">
                    Street address must be less than 200 characters
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Zip Code</mat-label>
                  <input
                    matInput
                    formControlName="zipCode"
                    placeholder="Enter 6-digit zip code"
                  />
                  <mat-icon matPrefix>markunread_mailbox</mat-icon>
                  <mat-error *ngIf="address?.get('zipCode')?.hasError('required')">
                    Zip code is required
                  </mat-error>
                  <mat-error *ngIf="address?.get('zipCode')?.hasError('pattern')">
                    Enter a valid 6-digit zip code
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <!-- Save Address Button -->
            <button
              mat-stroked-button
              type="button"
              (click)="saveAddress()"
              [disabled]="address?.invalid || addressButtonLoading"
              style="margin-top: 16px;">
              <mat-icon *ngIf="!addressButtonLoading">save</mat-icon>
              <mat-spinner diameter="20" *ngIf="addressButtonLoading"></mat-spinner>
              {{ addressButtonLoading ? 'Saving...' : 'Save Address' }}
            </button>

            <!-- Address Grid/Table -->
            <div style="margin-top: 20px;" *ngIf="savedAddresses?.length">
              <h4 style="margin-bottom: 10px; color: #333;">Saved Addresses</h4>
              <table mat-table [dataSource]="savedAddresses" class="mat-elevation-z8" style="width: 100%;">
                <!-- Index Column -->
                <ng-container matColumnDef="index">
                  <th mat-header-cell *matHeaderCellDef>#</th>
                  <td mat-cell *matCellDef="let element; let i = index">{{ i + 1 }}</td>
                </ng-container>

                <!-- Country Column -->
                <ng-container matColumnDef="country">
                  <th mat-header-cell *matHeaderCellDef>Country</th>
                  <td mat-cell *matCellDef="let element">{{ element.countryName }}</td>
                </ng-container>

                <!-- State Column -->
                <ng-container matColumnDef="state">
                  <th mat-header-cell *matHeaderCellDef>State</th>
                  <td mat-cell *matCellDef="let element">{{ element.stateName }}</td>
                </ng-container>

                <!-- City Column -->
                <ng-container matColumnDef="city">
                  <th mat-header-cell *matHeaderCellDef>City</th>
                  <td mat-cell *matCellDef="let element">{{ element.cityName }}</td>
                </ng-container>

                <!-- Street Column -->
                <ng-container matColumnDef="street">
                  <th mat-header-cell *matHeaderCellDef>Street</th>
                  <td mat-cell *matCellDef="let element">{{ element.street }}</td>
                </ng-container>

                <!-- Zip Column -->
                <ng-container matColumnDef="zip">
                  <th mat-header-cell *matHeaderCellDef>Zip Code</th>
                  <td mat-cell *matCellDef="let element">{{ element.zipCode }}</td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
              </table>
            </div>
          </div>
        </div>
        <!-- Name Fields Row -->
        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>First Name</mat-label>
            <input
              matInput
              formControlName="firstName"
              placeholder="Enter first name"
            />
            <mat-icon matPrefix>person</mat-icon>
            <mat-error
              *ngIf="registrationForm.get('firstName')?.hasError('required')"
            >
              First Name is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Middle Name</mat-label>
            <input
              matInput
              formControlName="middleName"
              placeholder="Enter middle name"
            />
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Last Name</mat-label>
            <input
              matInput
              formControlName="lastName"
              placeholder="Enter last name"
            />
            <mat-icon matPrefix>person</mat-icon>
            <mat-error
              *ngIf="registrationForm.get('lastName')?.hasError('required')"
            >
              Last Name is required
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Occupation and Income Fields Row -->
        <div class="form-row">
              <mat-form-field appearance="outline" class="form-field">
            <mat-label>Date of Birth</mat-label>
            <input
              matInput
              [matDatepicker]="picker"
              formControlName="dob"
              placeholder="Select your date of birth"
              [max]="maxDate"
              [disabled]="loading"
            />
            <mat-icon matPrefix>cake</mat-icon>
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error *ngIf="registrationForm.get('dob')?.hasError('required')">
              Date of Birth is required & You must be at least 18 years old
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Occupation</mat-label>
            <input
              matInput
              formControlName="occupation"
              placeholder="Enter occupation"
            />
            <mat-icon matPrefix>work</mat-icon>
            <mat-error *ngIf="registrationForm.get('occupation')?.hasError('required')">
              Occupation is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Income Range</mat-label>
            <mat-select formControlName="income">
              <mat-option *ngFor="let income of incomeOptions" [value]="income.id">
                {{ income.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="registrationForm.get('income')?.hasError('required')">
              Income range is required
            </mat-error>
          </mat-form-field>
        </div>
        <div class="form-row">
          <common-file-upload [title]="'Candidate Photo'"
            (uploadComplete)="handleUploadComplete($event)"></common-file-upload>
  
          <common-file-upload [title]="' Income Proof Document'"
            (uploadComplete)="handleincomeProofUploadComplete($event)"></common-file-upload>
        </div>
   
    </form>
    </mat-card-content>
    <mat-card-actions>
      <button
        mat-stroked-button
        type="button"
        (click)="onClear()"
      >
        <mat-icon>clear</mat-icon>
        Cancel
      </button>
      <button
        mat-raised-button
        color="primary"
        type="submit"
        (click)="onSubmit()"
        [disabled]="registrationForm.invalid || loading">
        <mat-icon *ngIf="!loading">save</mat-icon>
        <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
        {{ loading ? 'Registering...' : 'Register' }}
      </button>
    </mat-card-actions>

  </mat-card>
</div>



